{
  "timestamp": "2025-07-25T17:42:03.769428",
  "database_config": {
    "host": "localhost",
    "port": 5438,
    "database": "app",
    "user": "postgres"
  },
  "test_results": [
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "database",
      "test": "connectivity",
      "success": true,
      "message": "Connected as postgres to app",
      "details": {
        "version": "PostgreSQL 16.4 (Debian 16.4-1.pgdg110+2) on x86_64-pc-linux-gnu, compiled by gcc (Debian 10.2.1-6) 10.2.1 20210110, 64-bit"
      },
      "execution_time": 0.09341716766357422
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "database",
      "test": "extensions",
      "success": true,
      "message": "All 4 extensions installed",
      "details": {
        "extensions": {
          "http": "1.7",
          "vector": "0.8.0",
          "age": "1.5.0",
          "pg_trgm": "1.6"
        }
      },
      "execution_time": 0.022919178009033203
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "initialization",
      "test": "finalize_script",
      "success": true,
      "message": "10_finalize.sql executed successfully",
      "details": {
        "api_key_created": "2025-07-25T16:32:49.547533",
        "api_proxy_configured": true,
        "age_preloaded": true,
        "session_preload_libraries": "age"
      },
      "execution_time": 0.01642608642578125
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "schema",
      "test": "model_tables",
      "success": true,
      "message": "All 13 model tables exist",
      "details": {
        "tables": {
          "p8.\"Agent\"": {
            "row_count": 1
          },
          "p8.\"Function\"": {
            "row_count": 0
          },
          "p8.\"Session\"": {
            "row_count": 2
          },
          "p8.\"AIResponse\"": {
            "row_count": 0
          },
          "p8.\"LanguageModelApi\"": {
            "row_count": 0
          },
          "p8.\"ModelField\"": {
            "row_count": 21
          },
          "p8.\"User\"": {
            "row_count": 0
          },
          "p8.\"ApiProxy\"": {
            "row_count": 1
          },
          "p8.\"Resources\"": {
            "row_count": 0
          },
          "p8.\"Task\"": {
            "row_count": 0
          },
          "p8.\"Project\"": {
            "row_count": 0
          },
          "p8.\"Settings\"": {
            "row_count": 3
          },
          "p8.\"Audit\"": {
            "row_count": 0
          }
        }
      },
      "execution_time": 0.07828998565673828
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "core",
      "test": "public.percolate",
      "success": true,
      "message": "Function exists (6 args)",
      "details": {},
      "execution_time": 0.0021550655364990234
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "core",
      "test": "public.percolate_signature",
      "success": true,
      "message": "Signature verified",
      "details": {
        "args": "text text, model character varying DEFAULT 'gpt-4.1-mini'::character varying, tool_names_in text[] DEFAULT NULL::text[], system_prompt text DEFAULT 'Respond to the users query using tools and functions as required'::text, token_override text DEFAULT NULL::text, temperature double precision DEFAULT 0.01",
        "returns": "TABLE(message_response text, tool_calls jsonb, tool_call_result jsonb, session_id_out uuid, status text)"
      },
      "execution_time": null
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "core",
      "test": "public.percolate_with_agent",
      "success": true,
      "message": "Function exists (8 args)",
      "details": {},
      "execution_time": 0.0009989738464355469
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "core",
      "test": "public.plan",
      "success": true,
      "message": "Function exists (4 args)",
      "details": {},
      "execution_time": 0.004317760467529297
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "core",
      "test": "public.run",
      "success": true,
      "message": "Function exists (4 args)",
      "details": {},
      "execution_time": 0.0008969306945800781
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "entities",
      "test": "p8.get_entities",
      "success": true,
      "message": "Function exists (2 args)",
      "details": {},
      "execution_time": 0.0016090869903564453
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "entities",
      "test": "p8.get_entities_signature",
      "success": true,
      "message": "Signature verified",
      "details": {
        "args": "keys text[], userid text DEFAULT NULL::text",
        "returns": "jsonb"
      },
      "execution_time": null
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "entities",
      "test": "p8.register_entities",
      "success": true,
      "message": "Function exists (3 args)",
      "details": {},
      "execution_time": 0.0007359981536865234
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "entities",
      "test": "p8.query_entity",
      "success": true,
      "message": "Function exists (6 args)",
      "details": {},
      "execution_time": 0.0007679462432861328
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "entities",
      "test": "p8.vector_search_entity",
      "success": true,
      "message": "Function exists (4 args)",
      "details": {},
      "execution_time": 0.0007722377777099609
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "entities",
      "test": "p8.get_entity_ids_by_description",
      "success": true,
      "message": "Function exists (3 args)",
      "details": {},
      "execution_time": 0.0009007453918457031
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "entities",
      "test": "p8.generate_markdown_prompt",
      "success": true,
      "message": "Function exists (2 args)",
      "details": {},
      "execution_time": 0.0006358623504638672
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "cypher",
      "test": "p8.add_relationship_to_node",
      "success": true,
      "message": "Function exists (9 args)",
      "details": {},
      "execution_time": 0.0007359981536865234
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "cypher",
      "test": "p8.get_connected_entities",
      "success": true,
      "message": "Function exists (1 args)",
      "details": {},
      "execution_time": 0.0007460117340087891
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "cypher",
      "test": "p8.get_paths",
      "success": true,
      "message": "Function exists (3 args)",
      "details": {},
      "execution_time": 0.0006227493286132812
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "cypher",
      "test": "p8.get_relationships",
      "success": true,
      "message": "Function exists (8 args)",
      "details": {},
      "execution_time": 0.0006542205810546875
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "cypher",
      "test": "public.cypher_query",
      "success": true,
      "message": "Function exists (3 args)",
      "details": {},
      "execution_time": 0.00057220458984375
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "search",
      "test": "p8.deep_search",
      "success": true,
      "message": "Function exists (3 args)",
      "details": {},
      "execution_time": 0.0007219314575195312
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "search",
      "test": "p8.fuzzy_match_node_key",
      "success": true,
      "message": "Function exists (2 args)",
      "details": {},
      "execution_time": 0.0006210803985595703
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "search",
      "test": "p8.parallel_search",
      "success": true,
      "message": "Function exists (6 args)",
      "details": {},
      "execution_time": 0.000881195068359375
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "search",
      "test": "p8.merge_search_results",
      "success": true,
      "message": "Function exists (7 args)",
      "details": {},
      "execution_time": 0.0009400844573974609
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "indexing",
      "test": "p8.build_graph_index",
      "success": true,
      "message": "Function exists (2 args)",
      "details": {},
      "execution_time": 0.0007610321044921875
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "indexing",
      "test": "p8.get_embedding_for_text",
      "success": true,
      "message": "Function exists (2 args)",
      "details": {},
      "execution_time": 0.0010347366333007812
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "indexing",
      "test": "p8.insert_entity_embeddings",
      "success": true,
      "message": "Function exists (2 args)",
      "details": {},
      "execution_time": 0.0006589889526367188
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "indexing",
      "test": "p8.generate_and_fetch_embeddings",
      "success": true,
      "message": "Function exists (5 args)",
      "details": {},
      "execution_time": 0.0013880729675292969
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "requests",
      "test": "p8.ask",
      "success": true,
      "message": "Function exists (6 args)",
      "details": {},
      "execution_time": 0.0007059574127197266
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "requests",
      "test": "p8.ask_signature",
      "success": true,
      "message": "Signature verified",
      "details": {
        "args": "message_payload json, session_id uuid DEFAULT NULL::uuid, functions_names text[] DEFAULT NULL::text[], model_name text DEFAULT 'gpt-4o-mini'::text, token_override text DEFAULT NULL::text, user_id uuid DEFAULT NULL::uuid",
        "returns": "TABLE(message_response text, tool_calls jsonb, tool_call_result jsonb, session_id_out uuid, status text)"
      },
      "execution_time": null
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "requests",
      "test": "p8.get_canonical_messages",
      "success": true,
      "message": "Function exists (3 args)",
      "details": {},
      "execution_time": 0.0006840229034423828
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "requests",
      "test": "p8.nl2sql",
      "success": true,
      "message": "Function exists (5 args)",
      "details": {},
      "execution_time": 0.0006108283996582031
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "requests",
      "test": "p8.request_openai",
      "success": true,
      "message": "Function exists (5 args)",
      "details": {},
      "execution_time": 0.0007071495056152344
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "requests",
      "test": "p8.request_anthropic",
      "success": true,
      "message": "Function exists (5 args)",
      "details": {},
      "execution_time": 0.0006699562072753906
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "requests",
      "test": "p8.request_google",
      "success": true,
      "message": "Function exists (5 args)",
      "details": {},
      "execution_time": 0.0006017684936523438
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "tools",
      "test": "p8.get_tools_by_name",
      "success": true,
      "message": "Function exists (2 args)",
      "details": {},
      "execution_time": 0.0009281635284423828
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "tools",
      "test": "p8.eval_function_call",
      "success": true,
      "message": "Function exists (2 args)",
      "details": {},
      "execution_time": 0.0010662078857421875
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "tools",
      "test": "p8.activate_functions_by_name",
      "success": true,
      "message": "Function exists (2 args)",
      "details": {},
      "execution_time": 0.0016150474548339844
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "tools",
      "test": "p8.get_session_functions",
      "success": true,
      "message": "Function exists (3 args)",
      "details": {},
      "execution_time": 0.0007140636444091797
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "utils",
      "test": "p8.create_session",
      "success": true,
      "message": "Function exists (4 args)",
      "details": {},
      "execution_time": 0.0007841587066650391
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "utils",
      "test": "p8.ping_api",
      "success": true,
      "message": "Function exists (0 args)",
      "details": {},
      "execution_time": 0.0005750656127929688
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "execution",
      "test": "version_check",
      "success": true,
      "message": "Executed successfully",
      "details": {
        "result_type": "str"
      },
      "execution_time": 0.0004899501800537109
    },
    {
      "timestamp": "2025-07-25 17:42:02",
      "category": "execution",
      "test": "current_time",
      "success": true,
      "message": "Executed successfully",
      "details": {
        "result_type": "datetime"
      },
      "execution_time": 0.0006389617919921875
    },
    {
      "timestamp": "2025-07-25 17:42:03",
      "category": "execution",
      "test": "p8_create_session",
      "success": true,
      "message": "Executed successfully",
      "details": {
        "result_type": "str"
      },
      "execution_time": 0.33515214920043945
    },
    {
      "timestamp": "2025-07-25 17:42:03",
      "category": "graph",
      "test": "age_loading",
      "success": true,
      "message": "AGE extension working correctly (1 nodes)",
      "details": {
        "node_count": "1"
      },
      "execution_time": 0.01684284210205078
    },
    {
      "timestamp": "2025-07-25 17:42:03",
      "category": "graph",
      "test": "cypher_function",
      "success": true,
      "message": "Cypher function available",
      "details": {},
      "execution_time": 0.0176849365234375
    },
    {
      "timestamp": "2025-07-25 17:42:03",
      "category": "graph",
      "test": "get_entities_empty",
      "success": true,
      "message": "get_entities function works with empty array",
      "details": {},
      "execution_time": 0.023578166961669922
    },
    {
      "timestamp": "2025-07-25 17:42:03",
      "category": "graph",
      "test": "get_entities_agent",
      "success": true,
      "message": "get_entities works with p8.Agent search",
      "details": {},
      "execution_time": 0.004311084747314453
    },
    {
      "timestamp": "2025-07-25 17:42:03",
      "category": "graph",
      "test": "get_fuzzy_entities",
      "success": true,
      "message": "get_fuzzy_entities works with agent search",
      "details": {},
      "execution_time": 0.013476133346557617
    },
    {
      "timestamp": "2025-07-25 17:42:03",
      "category": "apis",
      "test": "language_model_config",
      "success": false,
      "message": "No language model APIs configured",
      "details": {},
      "execution_time": 0.0006957054138183594
    },
    {
      "timestamp": "2025-07-25 17:42:03",
      "category": "api",
      "test": "health_check",
      "success": true,
      "message": "API health endpoint is accessible",
      "details": {
        "response": {
          "url": "http://percolate-api:5008/health",
          "status": "up",
          "service": "percolate-api",
          "test_auth": false,
          "timestamp": "2025-07-25T16:42:03.373544",
          "http_status": 200,
          "response_body": "{\"status\":\"ok\"}",
          "response_time_ms": 3.83
        }
      },
      "execution_time": 0.008309125900268555
    },
    {
      "timestamp": "2025-07-25 17:42:03",
      "category": "api",
      "test": "auth_test",
      "success": true,
      "message": "API authentication with database token successful",
      "details": {
        "auth_result": {
          "url": "http://percolate-api:5008/admin/index/",
          "status": "up",
          "service": "percolate-api",
          "test_auth": true,
          "timestamp": "2025-07-25T16:42:03.380689",
          "auth_status": "authorized",
          "http_status": 200,
          "response_time_ms": 186.786
        }
      },
      "execution_time": 0.1903831958770752
    },
    {
      "timestamp": "2025-07-25 17:42:03",
      "category": "ai",
      "test": "percolate_query",
      "success": false,
      "message": "AI query test failed",
      "details": {
        "error": "Missing required API details for request. Model request is <NULL>s, scheme=<NULL>s\nCONTEXT:  PL/pgSQL function percolate_with_agent(text,text,character varying,text[],text,text,uuid,double precision) line 51 at RAISE\nSQL statement \"SELECT * FROM percolate_with_agent(text,'p8.PercolateAgent')\"\nPL/pgSQL function percolate(text,character varying,text[],text,text,double precision) line 3 at RETURN QUERY\n"
      },
      "execution_time": 0.18235993385314941
    }
  ],
  "summary": {
    "total_tests": 54,
    "passed": 52,
    "failed": 2,
    "categories": [
      "ai",
      "schema",
      "entities",
      "requests",
      "utils",
      "api",
      "database",
      "cypher",
      "search",
      "apis",
      "core",
      "execution",
      "graph",
      "tools",
      "initialization",
      "indexing"
    ],
    "function_categories": {
      "core": [
        "public.percolate",
        "public.percolate_with_agent",
        "public.plan",
        "public.run"
      ],
      "entities": [
        "p8.get_entities",
        "p8.register_entities",
        "p8.query_entity",
        "p8.vector_search_entity",
        "p8.get_entity_ids_by_description",
        "p8.generate_markdown_prompt"
      ],
      "cypher": [
        "p8.add_relationship_to_node",
        "p8.get_connected_entities",
        "p8.get_paths",
        "p8.get_relationships",
        "public.cypher_query"
      ],
      "search": [
        "p8.deep_search",
        "p8.fuzzy_match_node_key",
        "p8.parallel_search",
        "p8.merge_search_results"
      ],
      "indexing": [
        "p8.build_graph_index",
        "p8.get_embedding_for_text",
        "p8.insert_entity_embeddings",
        "p8.generate_and_fetch_embeddings"
      ],
      "requests": [
        "p8.ask",
        "p8.get_canonical_messages",
        "p8.nl2sql",
        "p8.request_openai",
        "p8.request_anthropic",
        "p8.request_google"
      ],
      "tools": [
        "p8.get_tools_by_name",
        "p8.eval_function_call",
        "p8.activate_functions_by_name",
        "p8.get_session_functions"
      ],
      "utils": [
        "p8.create_session",
        "p8.ping_api"
      ]
    }
  }
}